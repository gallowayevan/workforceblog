<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <title>NC Health Workforce - How has the supply of health professionals changed over time in rural and metro areas?</title>
  <meta name="description" content="North Carolina Health Professions Data System">
  <meta name="author" content="Sheps Center">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="../css/normalize.css" type="text/css">
  <link rel="stylesheet" href="../css/skeleton-no-grid.css" type="text/css">
  <link rel="stylesheet" href="../css/main.css" type="text/css">

  <link rel='stylesheet' href='../css/awesomplete.css' type='text/css'>
  <style>undefined</style>
</head>

<body>

  <div class="Navbar">
    <div class="Navbar__Link" id="Navbar__Link-brand">
    <a href="/"><svg class="header-logo" xmlns="http://www.w3.org/2000/svg"  width = "200px" viewBox="0 0 600.38 111.3"><defs><style>.cls-0{fill:#000000;}.cls-1{fill:#767171;}.cls-2{fill:#33669a;}.cls-3{fill:#006837;}</style></defs><title>Sheps Health Workforce NC</title><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path class='cls-0' d="M2.53,35.37l15.15-.95a11.54,11.54,0,0,0,2,5.62,8.4,8.4,0,0,0,7,3.13A7.76,7.76,0,0,0,32,41.57a4.58,4.58,0,0,0,.09-7.29c-1.17-1.06-3.89-2.05-8.15-3Q13.43,28.94,9,25a12.59,12.59,0,0,1-4.5-10,13.45,13.45,0,0,1,2.31-7.5A15.24,15.24,0,0,1,13.69,2q4.64-2,12.68-2,9.87,0,15.06,3.67T47.6,15.36l-15,.88a8.09,8.09,0,0,0-2.51-5.06A8.1,8.1,0,0,0,24.79,9.6a6.37,6.37,0,0,0-4.19,1.18,3.59,3.59,0,0,0-1.4,2.86,2.87,2.87,0,0,0,1.16,2.22q1.13,1,5.34,1.89,10.44,2.25,15,4.56A15.7,15.7,0,0,1,47.23,28a14.5,14.5,0,0,1,2.06,7.63,16.33,16.33,0,0,1-2.74,9.14,17.17,17.17,0,0,1-7.67,6.34A30.81,30.81,0,0,1,26.47,53.3q-13.14,0-18.21-5.07A20,20,0,0,1,2.53,35.37Z"/><path class='cls-0' d="M57.38.88H73.3v18H90.7V.88h16V52.42h-16V31.57H73.3V52.42H57.38Z"/><path class='cls-0' d="M117.25.88h42.68v11H133.21v8.19H158V30.59H133.21V40.75H160.7V52.42H117.25Z"/><path class='cls-0' d="M169.21.88h26.47q8.65,0,12.95,4.11t4.31,11.71q0,7.8-4.69,12.2t-14.33,4.39H185.2V52.42h-16Zm16,22h3.91q4.6,0,6.46-1.6a5.12,5.12,0,0,0,1.87-4.09A5.74,5.74,0,0,0,195.82,13q-1.62-1.68-6.08-1.68H185.2Z"/><path class='cls-0' d="M218.5,35.37l15.15-.95a11.54,11.54,0,0,0,2,5.62,8.42,8.42,0,0,0,7,3.13,7.77,7.77,0,0,0,5.26-1.6,4.79,4.79,0,0,0,1.85-3.71A4.73,4.73,0,0,0,248,34.28c-1.17-1.06-3.89-2.05-8.16-3Q229.4,28.94,224.93,25a12.59,12.59,0,0,1-4.5-10,13.52,13.52,0,0,1,2.3-7.5A15.32,15.32,0,0,1,229.66,2q4.62-2,12.67-2,9.88,0,15.07,3.67t6.17,11.69l-15,.88A8,8,0,0,0,246,11.18a8.1,8.1,0,0,0-5.29-1.58,6.34,6.34,0,0,0-4.18,1.18,3.6,3.6,0,0,0-1.41,2.86,2.9,2.9,0,0,0,1.16,2.22q1.13,1,5.34,1.89,10.46,2.25,15,4.56A15.73,15.73,0,0,1,263.2,28a14.49,14.49,0,0,1,2.05,7.63,16.33,16.33,0,0,1-2.74,9.14,17.14,17.14,0,0,1-7.66,6.34,30.81,30.81,0,0,1-12.41,2.17q-13.16,0-18.21-5.07A19.89,19.89,0,0,1,218.5,35.37Z"/><path class="cls-1" d="M0,58.88H15.13l5.44,28.85,8-28.85H43.62l8,28.81,5.45-28.81h15L60.74,110.42H45.13L36.09,78l-9,32.45H11.47Z"/><path class="cls-1" d="M69.39,84.68q0-12.62,7-19.65T96,58q12.87,0,19.83,6.91t7,19.35q0,9-3,14.82a21.66,21.66,0,0,1-8.79,9q-5.76,3.21-14.33,3.22t-14.43-2.78A21.65,21.65,0,0,1,73,99.73Q69.4,93.72,69.39,84.68Zm15.93.07q0,7.81,2.9,11.22a9.83,9.83,0,0,0,7.89,3.41,9.81,9.81,0,0,0,8-3.34q2.81-3.35,2.81-12,0-7.27-2.93-10.63a10.05,10.05,0,0,0-8-3.36,9.67,9.67,0,0,0-7.73,3.41Q85.32,76.88,85.32,84.75Z"/><path class="cls-1" d="M126.91,110.42V58.88h26.54a38.68,38.68,0,0,1,11.28,1.26,12,12,0,0,1,6.3,4.7,14.25,14.25,0,0,1,2.39,8.35,13.77,13.77,0,0,1-6.86,12.44,19.34,19.34,0,0,1-5.6,2,16.23,16.23,0,0,1,4.15,1.9,16.25,16.25,0,0,1,2.55,2.71,21.1,21.1,0,0,1,2.23,3.2l7.71,14.94h-18l-8.52-15.75a11.92,11.92,0,0,0-2.88-4,6.67,6.67,0,0,0-3.9-1.2H142.9v20.92Zm16-30.66h6.72a23.92,23.92,0,0,0,4.22-.7,4.21,4.21,0,0,0,2.58-1.62,5.23,5.23,0,0,0-.58-6.82c-1.05-.89-3-1.33-5.94-1.33h-7Z"/><path class="cls-1" d="M178.09,58.88H194V78.36L210.7,58.88h21.18L213.07,78.33l19.65,32.09H213.11l-10.87-21.2L194,97.84v12.58H178.09Z"/><path class="cls-1" d="M233.38,58.88h39.38V70H249.38v9h20V89.36h-20v21.06h-16Z"/><path class="cls-1" d="M274.65,84.68q0-12.62,7-19.65t19.58-7q12.87,0,19.83,6.91t7,19.35q0,9-3,14.82a21.66,21.66,0,0,1-8.79,9q-5.76,3.21-14.33,3.22t-14.43-2.78a21.65,21.65,0,0,1-9.26-8.79Q274.65,93.72,274.65,84.68Zm15.93.07q0,7.81,2.9,11.22a11,11,0,0,0,15.84.07q2.81-3.35,2.81-12,0-7.27-2.93-10.63a10.05,10.05,0,0,0-8-3.36,9.67,9.67,0,0,0-7.73,3.41Q290.58,76.88,290.58,84.75Z"/><path class="cls-1" d="M332.17,110.42V58.88h26.54A38.68,38.68,0,0,1,370,60.14a12,12,0,0,1,6.3,4.7,14.25,14.25,0,0,1,2.39,8.35,13.77,13.77,0,0,1-6.86,12.44,19.38,19.38,0,0,1-5.59,2,16.3,16.3,0,0,1,4.14,1.9,15.84,15.84,0,0,1,2.55,2.71,21.1,21.1,0,0,1,2.23,3.2l7.71,14.94h-18l-8.52-15.75a11.92,11.92,0,0,0-2.88-4,6.67,6.67,0,0,0-3.9-1.2h-1.41v20.92Zm16-30.66h6.72a23.92,23.92,0,0,0,4.22-.7,4.21,4.21,0,0,0,2.58-1.62,5.23,5.23,0,0,0-.58-6.82q-1.59-1.34-5.94-1.33h-7Z"/><path class="cls-1" d="M416.29,89.32l14,4.22a25.79,25.79,0,0,1-4.43,9.81,19.15,19.15,0,0,1-7.51,5.94,28,28,0,0,1-11.41,2q-8.4,0-13.72-2.45a21.77,21.77,0,0,1-9.2-8.58q-3.87-6.15-3.86-15.74,0-12.8,6.8-19.66T406.17,58q9.74,0,15.31,3.94T429.76,74l-14.07,3.13a12.07,12.07,0,0,0-1.54-3.45,9.27,9.27,0,0,0-3.27-2.81,9.48,9.48,0,0,0-4.33-1,9.34,9.34,0,0,0-8.29,4.35q-2.19,3.24-2.18,10.15,0,8.56,2.6,11.75A8.93,8.93,0,0,0,406,99.34q4.58,0,6.91-2.56A15.84,15.84,0,0,0,416.29,89.32Z"/><path class="cls-1" d="M433.27,58.88H476v11H449.23v8.19H474V88.59H449.23V98.75h27.49v11.67H433.27Z"/><path class="cls-2" d="M284.05.88H300v18h17.4V.88h16V52.42h-16V31.57H300V52.42H284.05Z"/><path class="cls-2" d="M343.92.88H386.6v11H359.88v8.19h24.78V30.59H359.88V40.75h27.49V52.42H343.92Z"/><path class="cls-2" d="M427.63,43.91H409.55L407,52.42H390.78L410.15.88h17.37l19.37,51.54H430.21Zm-3.3-11.14-5.69-18.53L413,32.77Z"/><path class="cls-2" d="M452,.88h15.93V39.73h24.85V52.42H452Z"/><path class="cls-2" d="M492.7.88h48.41V13.61H524.87V52.42H508.94V13.61H492.7Z"/><path class="cls-2" d="M548.38.88h15.93v18h17.4V.88h16V52.42h-16V31.57h-17.4V52.42H548.38Z"/><path class="cls-3" d="M496.91,58.88h14.88l19.4,28.51V58.88h15v51.54h-15l-19.3-28.3v28.3h-15Z"/><path class="cls-3" d="M586.42,89.32l14,4.22a25.79,25.79,0,0,1-4.43,9.81,19.15,19.15,0,0,1-7.51,5.94,28,28,0,0,1-11.41,2q-8.4,0-13.73-2.45a21.75,21.75,0,0,1-9.19-8.58q-3.87-6.15-3.87-15.74,0-12.8,6.8-19.66T576.29,58q9.74,0,15.31,3.94T599.88,74l-14.06,3.13a12,12,0,0,0-1.55-3.45A9.27,9.27,0,0,0,581,70.9a9.47,9.47,0,0,0-4.32-1,9.36,9.36,0,0,0-8.3,4.35q-2.18,3.24-2.18,10.15,0,8.56,2.6,11.75a9,9,0,0,0,7.32,3.17c3,0,5.35-.85,6.91-2.56A16,16,0,0,0,586.42,89.32Z"/></g></g></svg>
 </a>  
   </div>
     <div class="Navbar__Link Navbar__Link-toggle">
       <a class="icon">&#9776;</a>
     </div>
   <nav class="Navbar__Items Navbar__Items--right">
      <div class="Navbar__Link">
            <a href="/blog">Blog</a>
          </div>
          <div class="Navbar__Link">
      <a href="/about">About</a>
          </div>
          <div class="Navbar__Link">
            <a href="/supply">Supply Data</a>
                </div>
             <div class="Navbar__Link">
             <a href="http://www.shepscenter.unc.edu/programs-projects/workforce/data-publications-resources/">Other Publications/Data</a>
                 </div>
   </nav>
 </div>
  <div class="content">
    <div class="title"><h5>How has the supply of health professionals changed over time in rural and metro areas?</h5></div>
  
    <p><input name="professionSelect" placeholder="Search for a health profession" id="professionSelect"/></p>
<div id="chart"></div>
<div id="table"></div>

<script src="../javascript/d3.min.js"></script>
<script src="https://d3js.org/d3-array.v2.min.js"></script>
<script src="../javascript/awesomplete.min.js"></script>
<!-- <script src="../javascript/autocomplete.min.js"></script> -->

 <script > 

 const omb_metro_map_2015 = new Map([["ALAMANCE","metro"],["ALEXANDER","metro"],["ALLEGHANY","nonmetro"],["ANSON","nonmetro"],["ASHE","nonmetro"],["AVERY","nonmetro"],["BEAUFORT","nonmetro"],["BERTIE","nonmetro"],["BLADEN","nonmetro"],["BRUNSWICK","metro"],["BUNCOMBE","metro"],["BURKE","metro"],["CABARRUS","metro"],["CALDWELL","metro"],["CAMDEN","nonmetro"],["CARTERET","nonmetro"],["CASWELL","nonmetro"],["CATAWBA","metro"],["CHATHAM","metro"],["CHEROKEE","nonmetro"],["CHOWAN","nonmetro"],["CLAY","nonmetro"],["CLEVELAND","nonmetro"],["COLUMBUS","nonmetro"],["CRAVEN","metro"],["CUMBERLAND","metro"],["CURRITUCK","metro"],["DARE","nonmetro"],["DAVIDSON","metro"],["DAVIE","metro"],["DUPLIN","nonmetro"],["DURHAM","metro"],["EDGECOMBE","metro"],["FORSYTH","metro"],["FRANKLIN","metro"],["GASTON","metro"],["GATES","metro"],["GRAHAM","nonmetro"],["GRANVILLE","nonmetro"],["GREENE","nonmetro"],["GUILFORD","metro"],["HALIFAX","nonmetro"],["HARNETT","nonmetro"],["HAYWOOD","metro"],["HENDERSON","metro"],["HERTFORD","nonmetro"],["HOKE","metro"],["HYDE","nonmetro"],["IREDELL","metro"],["JACKSON","nonmetro"],["JOHNSTON","metro"],["JONES","metro"],["LEE","nonmetro"],["LENOIR","nonmetro"],["LINCOLN","metro"],["MCDOWELL","nonmetro"],["MACON","nonmetro"],["MADISON","metro"],["MARTIN","nonmetro"],["MECKLENBURG","metro"],["MITCHELL","nonmetro"],["MONTGOMERY","nonmetro"],["MOORE","nonmetro"],["NASH","metro"],["NEW HANOVER","metro"],["NORTHAMPTON","nonmetro"],["ONSLOW","metro"],["ORANGE","metro"],["PAMLICO","metro"],["PASQUOTANK","nonmetro"],["PENDER","metro"],["PERQUIMANS","nonmetro"],["PERSON","metro"],["PITT","metro"],["POLK","nonmetro"],["RANDOLPH","metro"],["RICHMOND","nonmetro"],["ROBESON","nonmetro"],["ROCKINGHAM","metro"],["ROWAN","metro"],["RUTHERFORD","nonmetro"],["SAMPSON","nonmetro"],["SCOTLAND","nonmetro"],["STANLY","nonmetro"],["STOKES","metro"],["SURRY","nonmetro"],["SWAIN","nonmetro"],["TRANSYLVANIA","nonmetro"],["TYRRELL","nonmetro"],["UNION","metro"],["VANCE","nonmetro"],["WAKE","metro"],["WARREN","nonmetro"],["WASHINGTON","nonmetro"],["WATAUGA","nonmetro"],["WAYNE","metro"],["WILKES","nonmetro"],["WILSON","nonmetro"],["YADKIN","metro"],["YANCEY","nonmetro"]]);

   d3.csv("https://data-dept-healthworkforce.cloudapps.unc.edu/data/specialties.csv", d3.autoType)
    .then(populateSelect)


    function populateSelect(data){
      const optionsMap = new Map(data.map(d=>[currProfessionName(d), d.id]));
        const options = data.map(d=>currProfessionName(d))
        const input = document.getElementById("professionSelect");

//         const myComponent = new AutoComplete({
//   target: document.querySelector('.content'),
//   data: { 
//     name: 'professionSelect',
//     itemStart: 1,
//     items: options,
//     minChar: 1,
//     fromStart: false
//   }
// })
        new Awesomplete(input, {
                minChars: 1,
                maxItems: 10,
                autoFirst: true,
                list: options
            });

        input.addEventListener("awesomplete-select", professionChanged);

      function professionChanged(selected){

      const currValue = optionsMap.get(selected.text.value);
      loadData(currValue)
    }

            function currProfessionName(currObject) {
  return currObject.profession == currObject.specialty
        ? currObject.profession
        : `${currObject.profession} - ${currObject.display_name}`
}
    }

    function loadData(id){
const dataLoaded = d3.csv(
  `https://data-dept-healthworkforce.cloudapps.unc.edu/data/region/spec${id.toString().padStart(
    3,
    "0"
  )}.csv`,
  function(e) {
    if (e.type != "county") return null;
    return {
          county: e.region,
          year: e.year,
          total: e.total,
          population: e.population,
          metro: omb_metro_map_2015.get(e.region.toUpperCase())
        };
  }
).then(function(data){
  return d3.rollup(
  data,
  function(v) {
    const population = d3.sum(v, e => e.population);
    const total = d3.sum(v, e => e.total);
    const rate = (total / population) * 10000;
    return {
      population: population,
      total: total,
      rate: rate
    };
  },
  d => d.metro,
  d => d.year
)
})
dataLoaded.then(drawChart);
dataLoaded.then(drawTable);
    }

    function drawTable(data){
     const rows = mapToObj(data).map(function(d){
  const newObj = {};
  d.children.forEach(function(e){
  newObj[e.name] = e.children
  })
  newObj["Metro"] = d.name.toUpperCase();
return newObj
});

      d3.select("#table").select("table").remove();
      const table = d3.select('#table')
        .append('table');

        table.append('thead').append('tr')
   .selectAll('th')
   .data(Object.keys(rows[0])).enter()
   .append('th')
   .attr('class', d=>d)
   .text(d=>d);
const format = d3.format(".2f")
table.append('tbody')
   .selectAll('tr')
   .data(rows).enter()
   .append('tr')
   .selectAll('td')
   .data(function(d,i){

     return Object.keys(d).map(e=>d[e])
   }).enter()
   .append('td')
   .html(d=>format(d.rate))
   .attr('class', d=>d);


    }

    function drawChart(countyGroups){

const width = 960;
const height = 450;
d3.select("#chart").selectAll("svg").remove()
const svg = d3.select("#chart").append("svg").attr("width", width).attr("height", height);

const margin = ({ top: 40, right: 100, bottom: 30, left: 40 });


const x = d3
  .scaleLinear()
  .domain(d3.extent(Array.from(countyGroups.get("metro").keys())))
  .range([margin.left, width - margin.right]);

  const y = d3
  .scaleLinear()
  .domain([
    0,
    Math.max(
      d3.max(
        Array.from(countyGroups.get("metro"), d => ({
          year: d[0],
          rate: d[1].rate
        })),
        d => d.rate
      ),
      d3.max(
        Array.from(countyGroups.get("nonmetro"), d => ({
          year: d[0],
          rate: d[1].rate
        })),
        d => d.rate
      )
    )
  ])
  .nice()
  .range([height - margin.bottom, margin.top]);

  const xAxis = g =>
  g.attr("transform", `translate(0,${height - margin.bottom})`).call(
    d3
      .axisBottom(x)
      .tickValues(d3.extent(Array.from(countyGroups.get("nonmetro").keys())))
      .tickFormat(d3.format(""))
      .tickSizeOuter(0)
  )

  const yAxis = g =>
  g
    .attr("transform", `translate(${margin.left},0)`)
    .call(d3.axisLeft(y).tickSizeInner(-width + margin.right + margin.left))
    .call(g => g.select(".domain").remove())
    .call(g => g.selectAll(".tick line").attr("stroke", "#bdbdbd"))
    .call(g =>
      g
        .select(".tick:last-of-type text")
        .clone()
        .attr("x", -30)
        .attr("dy", -15)
        .attr("text-anchor", "start")
        .attr("font-weight", "bold")
        .text("Rate per 10,000 population")
    )

const line = d3.line()
    .x(d => x(d.year))
    .y(d => y(d.rate))

  svg.append("g").call(xAxis);

  svg.append("g").call(yAxis);

  const rural = Array.from(countyGroups.get("nonmetro"), d => ({
    year: d[0],
    rate: d[1].rate
  }));
  const metro = Array.from(countyGroups.get("metro"), d => ({
    year: d[0],
    rate: d[1].rate
  }));

  svg
    .append("path")
    .datum(rural)
    .attr("fill", "none")
    .attr("stroke", "darkgreen")
    .attr("stroke-width", 3)
    .attr("stroke-linejoin", "round")
    .attr("stroke-linecap", "round")
    .attr("d", line);

  svg
    .append("path")
    .datum(metro)
    .attr("fill", "none")
    .attr("stroke", "steelblue")
    .attr("stroke-width", 3)
    .attr("stroke-linejoin", "round")
    .attr("stroke-linecap", "round")
    .attr("d", line);

  svg
    .selectAll("ruralAnnotation")
    .data(rural)
    .enter()
    .append("text")
    .attr("x", d => x(d.year) + 15)
    .attr("y", d => y(d.rate) - 10)
    .text((d, i) =>
      i == 0 || i == rural.length - 1 ? d3.format(".3r")(d.rate) : ""
    )
    .attr("text-anchor", "middle")
    .attr("font-size", 14);

  svg
    .selectAll("metroAnnotation")
    .data(metro)
    .enter()
    .append("text")
    .attr("x", d => x(d.year) + 15)
    .attr("y", d => y(d.rate) - 10)
    .text((d, i) =>
      i == 0 || i == metro.length - 1 ? d3.format(".3r")(d.rate) : ""
    )
    .attr("text-anchor", "middle")
    .attr("font-size", 14);


    }

    function mapToObj(map) {
  if (map instanceof Map) {
    return Array.from(map).map(([key, val]) => ({name:key, children:mapToObj(val)}));
  }
  return map;
}


            </script>
    
     
  </div>


  <div class="footer">
      <div class="logo">
        <img src="../images/sheps_logo_blue_horizontal.svg" />
      </div>
      <div class="contact">
        <!-- Email -->
        <div class="sharing">
          Email us: <a href="mailto:nchealthworkforce@unc.edu?subject=Question%20about%20the%20North%20Carolina%20Health%20Workforce%20website"
            target="_self" aria-label="Email Us.">
            nchealthworkforce@unc.edu
          </a>
        </div>
                   <!-- RSS -->
                   <div class="sharing">
                    <a href="/rss.xml"
                      target="_self" aria-label="RSS">
                      RSS
                    </a>
                  </div>
        <!-- Twitter -->
        <div class="sharing">
          <a href="https://twitter.com/intent/tweet/?text=Check%20out%20the%20North%20Carolina%20Health%20Workforce%20website.&amp;url=https%3A%2F%2Fgo.unc.edu%2Fhpds"
            target="_blank" aria-label="Share on Twitter">
            Share on Twitter
          </a>
        </div>
  
        <!-- Facebook -->
        <div class="sharing">
          <a href="https://facebook.com/sharer/sharer.php?u=https%3A%2F%2Fgo.unc.edu%2Fhpds" target="_blank" aria-label="Share on Facebook">
            Share on Facebook
          </a>
        </div>
        <!-- LinkedIn -->
        <div class="sharing">
          <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fgo.unc.edu%2Fhpds&amp;title=Check%20out%20the%20North%20Carolina%20Health%20Workforce%20website.&amp;summary=Check%20out%20the%20North%20Carolina%20Health%20Workforce%20website.&amp;source=https%3A%2F%2Fgo.unc.edu%2Fhpds"
            target="_blank" aria-label="Share on LinkedIn">
            Share on LinkedIn
          </a>
        </div>
  
      </div>
    </div>
  


    <script>
      function classToggle() {
        const navs = document.querySelectorAll('.Navbar__Items')
        
        navs.forEach(nav => nav.classList.toggle('Navbar__ToggleShow'));
      }
      
      document.querySelector('.Navbar__Link-toggle')
        .addEventListener('click', classToggle);
        </script>

</body>

</html>